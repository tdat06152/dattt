<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Workflow with Video Preview & Popup</title>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  <style>
    .mermaid {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
    }

    .video-preview {
      position: absolute;
      display: none;
      z-index: 10;
      width: 320px;
      height: 180px;
      border: 2px solid #ccc;
      background-color: #000;
    }

    .video-preview iframe {
      width: 100%;
      height: 100%;
    }

    .video-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: rgba(0,0,0,0.7);
      z-index: 999;
      justify-content: center;
      align-items: center;
    }

    .video-popup iframe {
      width: 800px;
      height: 450px;
      border: none;
    }

    .video-popup .close-btn {
      position: absolute;
      top: 20px;
      right: 40px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="mermaid" id="workflow">
    graph TD
      A1([1. Bắt đầu công việc]) --> A2([2. Nhận kiện luân chuyển])
      A2 -->|No| A2a([Lập biên bản sự cố<br>(nếu chênh lệch)]) --> A3
      A2 -->|Yes| A3([3. Rã kiện])
      A3 --> A4([4. Cập nhật thông tin<br>hệ thống và xử lý sự cố])
      A4 --> A5([5. Phân hàng và tạo chuyển đi cho NVPTTT/CTV])
      A5 --> A6([6. Bàn giao hàng hóa cho NVPTTT/CTV])
      A6 --> A7([7. Xử lý thông tin/sản phẩm phát sinh])
      A7 -->|Yes| A8([8. Nhận hàng hoàn bàn giao])
      A8 -->|Yes| A9([9. Thu tiền và tạo phiếu thu])
      A9 -->|Yes| A10([10. Phân loại và tạo phiếu luân chuyển])
      A10 --> A11([11. Kiểm kho])
      A11 --> A12([12. Kiểm đếm và nộp tiền])
      A12 -->|Yes| A13([13. Lưu trữ thông tin và chứng từ])
      A12 -->|No| A12a([Thông báo thông tin đến Kế toán<br>(nếu có chênh lệch)])
      A7 -->|No| A7a([Thông tin đến Quản lý tạo phiếu QLRR trên HRW])
      A8 -->|No| A8a([Thông tin đến Quản lý tạo phiếu QLRR trên HRW])
  </div>

  <!-- Hover preview -->
  <div class="video-preview" id="previewBox">
    <iframe id="previewVideo" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>

  <!-- Click popup -->
  <div class="video-popup" id="popupBox">
    <span class="close-btn" onclick="closePopup()">&times;</span>
    <iframe id="popupVideo" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>

  <script>
    // Mapping node IDs to video links
    const videoLinks = {
      A1: "https://drive.google.com/file/d//preview",
      A2: "https://drive.google.com/file/d/your-file-id-2/preview",
      A3: "https://drive.google.com/file/d/your-file-id-3/preview",
      A4: "https://drive.google.com/file/d/your-file-id-4/preview",
      A5: "https://drive.google.com/file/d/your-file-id-5/preview",
      A6: "https://drive.google.com/file/d/your-file-id-6/preview",
      A7: "https://drive.google.com/file/d/your-file-id-7/preview",
      A8: "https://drive.google.com/file/d/your-file-id-8/preview",
      A9: "https://drive.google.com/file/d/your-file-id-9/preview",
      A10: "https://drive.google.com/file/d/your-file-id-10/preview",
      A11: "https://drive.google.com/file/d/your-file-id-11/preview",
      A12: "https://drive.google.com/file/d/your-file-id-12/preview",
      A13: "https://drive.google.com/file/d/your-file-id-13/preview"
    };

    const previewBox = document.getElementById('previewBox');
    const previewVideo = document.getElementById('previewVideo');
    const popupBox = document.getElementById('popupBox');
    const popupVideo = document.getElementById('popupVideo');

    function closePopup() {
      popupBox.style.display = "none";
      popupVideo.src = "";
    }

    setTimeout(() => {
      for (const id in videoLinks) {
        const el = document.querySelector(`#workflow [id*="${id}"]`);
        if (el) {
          // Hover: preview small video
          el.addEventListener("mouseenter", (e) => {
            previewVideo.src = videoLinks[id];
            previewBox.style.display = "block";
            previewBox.style.left = e.pageX + 20 + "px";
            previewBox.style.top = e.pageY - 100 + "px";
          });
          el.addEventListener("mousemove", (e) => {
            previewBox.style.left = e.pageX + 20 + "px";
            previewBox.style.top = e.pageY - 100 + "px";
          });
          el.addEventListener("mouseleave", () => {
            previewBox.style.display = "none";
            previewVideo.src = "";
          });

          // Click: open popup video
          el.addEventListener("click", () => {
            popupVideo.src = videoLinks[id];
            popupBox.style.display = "flex";
          });
        }
      }
    }, 1000);
  </script>
</body>
</html>
